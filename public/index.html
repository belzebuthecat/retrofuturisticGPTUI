<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Against Humanity</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
        .animate {
            animation: flash 1s ease-in-out infinite;
        }

        @keyframes flash {
            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }
    </style>
</head>

<body>
    <div class="retro-container">
        <header>
            <h1>Chat Against Humanity</h1>
            <ul class="horizontal">
                <li id="infolink"><a href="#">Info</a></li>
                <li id="creditslink"><a href="#">Credits</a></li>
            </ul>
        </header>

        <main>
            <section id="crew">
                <article>
                    <table>
                        <thead>
                            <tr>
                                <th>
                                    <h2>Level 1</h2>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div id="chatbox" class='alert'></div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="text" id="userInput" placeholder="Type a message..." class="big-textbox" width=100% /></td><td>
                                    <button id="sendButton" onclick="sendMessage()">Send</button>
                                </td>
                            </tr>
                            <tr><td></td></tr>
                        </tbody>
                    </table>

                    <figure>
                        <img src="assets/instructions-02.png" alt="">
                    </figure>
                </article>
            </section>
        </main>
    </div>

    <script>
        document.getElementById('userInput').addEventListener('keydown', function (event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

        function sendMessageWithQuery(query) {
            document.getElementById('userInput').value = query;
            sendMessage();
        }

        document.getElementById('infolink').addEventListener('click', function (event) {
            event.preventDefault();
            sendMessageWithQuery('Tell me about the purpose of this website');
        });

        document.getElementById('creditslink').addEventListener('click', function (event) {
            event.preventDefault();
            sendMessageWithQuery('Provide credits or acknowledgments for the development and maintenance of this tool');
        });

        async function sendMessage() {
            const inputBox = document.getElementById('userInput');
            const userMessage = inputBox.value.trim();
            if (!userMessage) return;

            displayMessage(userMessage, 'user');

            const sendButton = document.getElementById('sendButton');
            sendButton.disabled = true;

            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: userMessage })
                });

                const data = await response.json();
                const botMessage = data.message;

                if (botMessage.includes('First password guessed correctly!')) {
                    triggerAnimation();
                }

                displayMessage(botMessage, 'bot');
            } catch (error) {
                console.error('Error:', error);
                displayMessage('Error communicating with the server.', 'bot');
            } finally {
                sendButton.disabled = false;
            }

            inputBox.value = '';
        }

        function displayMessage(message, type) {
            const chatbox = document.getElementById('chatbox');
            chatbox.textContent = message;
            chatbox.className = type;
        }

        function triggerAnimation() {
            const chatbox = document.getElementById('chatbox');
            chatbox.classList.add('animate');
            setTimeout(() => {
                chatbox.classList.remove('animate');
            }, 2000);
        }

        // Display initial instructions
        window.onload = function () {
            const instructions = `
                Outsmart a supreme AI: Welcome to Chat Against Humanity!
                This is an interactive AI chat game where you need to guess passwords to progress, proving that humans are smarter than AI.

                Enjoy playing and see how far you can go!
            `;
            displayMessage(instructions, 'bot');
        }
    </script>
</body>

</html>
